<div class="color-palette-viewer-container bg-white p-6 rounded-lg shadow-md mt-8">
    <h2 class="text-2xl font-semibold mb-4 text-center text-gray-800">Hierarchical Color History</h2>

    <div class="main-content grid grid-cols-1 md:grid-cols-[150px_1fr] gap-6">
        <div *ngIf="imageUrl" class="image-preview-column flex items-center justify-center p-2 border border-gray-200 rounded-md bg-gray-50 overflow-hidden min-h-[150px]">
            <img [src]="imageUrl" alt="Source Image" class="max-w-full max-h-full object-contain rounded-sm" />
        </div>

        <div class="palette-and-controls-column flex flex-col">
            <div class="mb-4 flex justify-center flex-grow">
                <div>
                <label class="block text-gray-600 font-medium mb-2 text-center">Display Format:</label>
                <nz-radio-group [(ngModel)]="currentFormat" (ngModelChange)="onFormatChange()" nzButtonStyle="solid">
                    <label nz-radio-button nzValue="rgb">RGB</label>
                    <label nz-radio-button nzValue="hex">HEX</label>
                    <label nz-radio-button nzValue="hsl">HSL</label>
                </nz-radio-group>
                </div>
            </div>

            <div class="flex justify-center items-center">
                <div #graphContainer class="overflow-hidden border border-gray-200 rounded-md"
                    >
                </div>
            </div>

            <div class="flex items-end justify-end mt-4">
                <button nz-button 
                        nzType="primary" 
                        nzSize="large" 
                        (click)="savePalette()" 
                        [disabled]="!paletteItem || paletteItem.palette?.length === 0 || !keycloakService.isLoggedIn()"
                        [nzTooltipTitle]="!keycloakService.isLoggedIn() ? 'Please log in to save your palette history.' : null"
                        [nzTooltipPlacement]="'top'"
                        nz-tooltip
                        *ngIf="!isModalView">
                    <nz-icon nzType="save" nzTheme="outline"></nz-icon>
                    Save Palette
                </button>

                <button nz-button 
                    nzType="default" 
                    nzSize="large" 
                    (click)="publishPalette()" 
                    [disabled]="!paletteItem || paletteItem.palette?.length === 0 || !keycloakService.isLoggedIn()"
                    [nzTooltipTitle]="!keycloakService.isLoggedIn() ? 'Please log in to save your palette history.' : null"
                    [nzTooltipPlacement]="'top'"
                    nz-tooltip
                    *ngIf="!isModalView">
                <nz-icon nzType="upload" nzTheme="outline" />
                Publish Palette
                </button>
            </div>
        </div>

        <div *ngIf="nodes.length === 0" class="text-gray-500 text-center w-full">
            No palette generated yet.
        </div>
    </div>

</div>